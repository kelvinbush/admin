# User Groups API â€” Frontend Integration Guide

This guide documents the endpoints, request/response formats, validation and pagination rules for the User Groups feature.

All endpoints are served from the API base and most require authorization via Clerk bearer token (Authorization: Bearer <token>), consistent with existing routes.

## Endpoints Overview

- POST /user-groups
- GET /user-groups
- GET /user-groups/:id
- PATCH /user-groups/:id
- DELETE /user-groups/:id
- GET /user-groups/:id/members (paginated)

## Create a Group

- Method: POST
- URL: /user-groups
- Auth: Required
- Body:
```json
{
  "name": "Operations",
  "slug": "ops",        // optional; autogenerated if omitted
  "description": "Ops team",
  "userIds": ["user_01", "user_02"] // optional; must be existing user IDs
}
```
- Response 200:
```json
{
  "id": "grp_01",
  "name": "Operations",
  "slug": "ops",
  "description": "Ops team",
  "createdAt": "2025-10-28T07:20:00.000Z",
  "updatedAt": "2025-10-28T07:20:00.000Z"
}
```
- Notes:
  - `name` is required and unique.
  - `slug` is unique. If omitted, it is autogenerated from `name` with `kebab-case` and a numeric suffix if needed.
  - If `userIds` are provided, only valid existing users are linked. Duplicates are ignored.

## List Groups

- Method: GET
- URL: /user-groups
- Auth: Not required for listing (unless your gateway enforces). Adjust as needed.
- Response 200:
```json
{
  "success": true,
  "message": "Groups retrieved successfully",
  "data": [
    {
      "id": "grp_01",
      "name": "Operations",
      "slug": "ops",
      "description": "Ops team",
      "createdAt": "2025-10-28T07:20:00.000Z",
      "updatedAt": "2025-10-28T07:20:00.000Z"
    }
  ]
}
```

## Get Group By ID

- Method: GET
- URL: /user-groups/:id
- Auth: Not required (adjust if needed)
- Params: `id` (string)
- Response 200: Same shape as create response
- Response 404: `{ error, code }`

## Update Group

- Method: PATCH
- URL: /user-groups/:id
- Auth: Required
- Body (any field optional; at least one required):
```json
{
  "name": "New Name",
  "slug": "new-slug",            
  "description": "New description",
  "userIds": ["user_01", "user_03"],     // Replace entire membership set
  "addUserIds": ["user_04", "user_05"],  // Incremental add (used only if userIds not provided)
  "removeUserIds": ["user_01"]            // Incremental remove
}
```
- Behavior:
  - If `userIds` is present, it REPLACES the full membership set.
  - Otherwise, `addUserIds`/`removeUserIds` apply incremental changes.
  - `slug` uniqueness is enforced; a numeric suffix may be applied if conflict occurs.
- Response 200: Updated group object

## Delete Group (Soft Delete)

- Method: DELETE
- URL: /user-groups/:id
- Auth: Required
- Response 200:
```json
{ "success": true, "message": "Group deleted successfully" }
```

## List Group Members (Paginated)

- Method: GET
- URL: /user-groups/:id/members
- Auth: Not required (adjust if needed)
- Query:
  - `page`: string integer (default: "1")
  - `limit`: string integer (default: "20", max: "100")
- Response 200:
```json
{
  "success": true,
  "message": "Group members retrieved successfully",
  "data": [
    {
      "id": "user_01",
      "firstName": "Ada",
      "lastName": "Lovelace",
      "email": "ada@example.com",
      "phoneNumber": "+254700...",
      "imageUrl": "https://..."
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 42,
    "totalPages": 3
  }
}
```

## Error Handling

- Errors follow the shared error schema:
```json
{ "error": "MESSAGE", "code": "ERROR_CODE" }
```
- HTTP status codes are properly set (400/401/404/500).

## Frontend Integration Tips

- Always send the Clerk session token in `Authorization: Bearer <token>` for routes marked as Auth Required.
- `slug` is optional on create; if not provided, UI can preview the auto-generated slug by applying `name.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').replace(/-{2,}/g,'-')`.
- For update membership, prefer `userIds` to replace the full set. Use `addUserIds`/`removeUserIds` for incremental edits (e.g., multi-select UIs).
- Implement pagination UI for members (page size up to 100). Keep the current page in route query params for deep-linking and back/forward navigation.
- Handle 409-like conflicts gracefully if backend returns a uniqueness violation message (currently normalized to 500 with error message; we can refine codes if needed).

## Curl Examples

Create group:
```bash
curl -X POST "$API_BASE/user-groups" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Ops",
    "description": "Operations",
    "userIds": ["user_01", "user_02"]
  }'
```

List members (page 2, 50 per page):
```bash
curl "$API_BASE/user-groups/grp_01/members?page=2&limit=50"
```

Update membership (replace set):
```bash
curl -X PATCH "$API_BASE/user-groups/grp_01" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "userIds": ["user_03", "user_04", "user_05"]
  }'
```

Soft delete group:
```bash
curl -X DELETE "$API_BASE/user-groups/grp_01" \
  -H "Authorization: Bearer $TOKEN"
```
